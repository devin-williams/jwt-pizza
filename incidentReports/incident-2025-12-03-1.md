# Incident: 2025-12-03 10:25

## Summary

Between the hours of 10:25 and 10:40 on December 3, 2025, users attempting to order pizzas encountered failures from the Pizza Factory service. The event was triggered by a chaos test initiated through the JWT Pizza Factory vendor account. The chaos test injected a "chaos monkey" failure mode into the factory service that caused all pizza orders to fail with the error message "Failed to fulfill order at factory".

The incident was detected by Grafana alerts monitoring order failure rates. The team identified the root cause within 15 minutes by examining error logs which revealed the chaos monkey message and a follow-up link to end the chaos. This was a planned chaos testing incident affecting pizza order fulfillment. The incident was resolved by accessing the provided report URL to terminate the chaos injection.

## Detection

This incident was detected when Grafana alerts monitoring pizza order failures were triggered at approximately 10:25 UTC, and the on-call engineer was notified.

The engineer immediately accessed the Grafana dashboard and examined the error logs, where the following key error messages were identified:

1. Factory service response: `{"message":"chaos monkey","reportUrl":"https://pizza-factory.cs329.click/api/support/60f1aece26c148b9b72c5f0934f0e0d7/report/u0cdt5qk"}`
2. Order service error: `{"message":"Failed to fulfill order at factory","followLinkToEndChaos":"https://pizza-factory.cs329.click/api/support/60f1aece26c148b9b72c5f0934f0e0d7/report/u0cdt5qk"}`

The error messages clearly indicated a chaos test was in progress and provided a direct link to resolve the issue. Detection was rapid due to proper alerting configuration on order failure metrics.

To improve time-to-detection further, we could implement:
- Real-time alerts on factory service response anomalies
- Synthetic monitoring that continuously tests the order flow
- Alert aggregation to distinguish between genuine outages and planned chaos tests

## Impact

For approximately 15 minutes between 10:25 UTC and 10:40 UTC on 12/03/2025, all users attempting to place pizza orders experienced order failures.

This incident affected 100% of users attempting to order pizzas during the chaos period. Users experienced order submission failures with error messages indicating the factory could not fulfill orders.

The exact number of impacted orders depends on traffic volume during the incident window. With the traffic simulation script running, an estimated 5-10 order attempts failed during this period.

## Timeline

All times are approximate and in local time (MST/UTC-7).

- **10:25** - Chaos test initiated by Pizza Factory, order failures begin
- **10:25** - Grafana alert triggered on order failure rate increase
- **10:26** - On-call engineer notified via Grafana OnCall
- **10:27** - Engineer accesses Grafana dashboard to investigate
- **10:28** - Engineer examines error logs and identifies chaos monkey messages
- **10:29** - Engineer locates report URL in error logs: `https://pizza-factory.cs329.click/api/support/60f1aece26c148b9b72c5f0934f0e0d7/report/u0cdt5qk`
- **10:30** - Engineer accesses report URL to terminate chaos injection
- **10:31** - Chaos test terminated, factory service returns to normal operation
- **10:32** - Engineer monitors dashboard to confirm order success rate returns to normal
- **10:40** - Incident confirmed resolved, monitoring continues

## Response

After receiving a Grafana alert at approximately 10:25 UTC, the on-call engineer came online immediately and began investigating the incident through the Grafana dashboard.

The engineer had familiarity with the chaos testing assignment requirements and recognized the error message pattern indicating a chaos test. This knowledge enabled rapid diagnosis and resolution.

No significant delays or obstacles were encountered during the response. The error messages provided clear guidance on how to resolve the incident by including the report URL directly in the logs.

## Root cause

The root cause of this incident was an intentional chaos test injection initiated through the JWT Pizza Factory vendor account as part of the CS 329 chaos testing assignment. The factory service was programmed to return "chaos monkey" errors for all order requests, simulating a complete factory outage scenario.

This was a planned test to validate:
1. Alerting systems properly detect and notify on order failures
2. Logging captures sufficient information to diagnose issues
3. On-call response procedures are effective
4. Time-to-detection and time-to-resolution meet operational standards

## Resolution

The service was restored by accessing the chaos report URL provided in the error messages: `https://pizza-factory.cs329.click/api/support/60f1aece26c148b9b72c5f0934f0e0d7/report/u0cdt5qk`

Clicking this link terminated the chaos injection, and the Pizza Factory service immediately resumed normal operation. Order success was verified through:
1. Monitoring the Grafana dashboard showing order success rate returning to 100%
2. Observing error logs no longer showing "chaos monkey" messages
3. Confirming that subsequent simulated traffic orders completed successfully

The resolution was straightforward because the error messages explicitly included the termination link. The key to fast resolution was:
- Having comprehensive logging that captured the full factory response
- Quick access to centralized logs through Grafana
- Clear error messages from the factory service

Time to mitigation could be improved by:
- Implementing automated chaos test detection based on specific error patterns
- Creating runbook links directly in alert messages for known chaos scenarios
- Setting up a dedicated chaos testing dashboard that auto-detects active tests

## Prevention

This was the first chaos testing incident for this system. As this was a planned educational exercise rather than an actual service failure, prevention focuses on improving future chaos test responses rather than preventing the chaos itself.

No previous incidents share this root cause as this was an intentional test scenario.

## Action items

1. **Alert configuration validated** - The existing Grafana alerts successfully detected the chaos incident. No changes needed to alert rules.

2. **Logging improvements** - Current logging successfully captured the chaos monkey messages and report URLs. Consider adding structured logging fields specifically for:
   - Factory service error types
   - Chaos test indicators
   - Resolution action URLs

3. **Runbook documentation** - Create a runbook entry for "Factory Service Chaos Test Response" that documents:
   - How to identify chaos test errors in logs
   - Steps to access the report URL and terminate chaos
   - Expected recovery time and validation steps
   - Owner: DevOps team, Complete by: End of week

4. **Dashboard enhancement** - Add a dedicated panel to the Grafana dashboard showing:
   - Factory service response types (success/error/chaos)
   - Link to most recent factory errors
   - Owner: DevOps team, Complete by: End of week

5. **Synthetic monitoring** - Implement continuous synthetic order testing to reduce detection time for future incidents (both chaos and real failures)
   - Owner: DevOps team, Complete by: Next sprint

6. **Post-chaos verification** - Add automated verification script to confirm all systems return to normal after chaos resolution
   - Owner: DevOps team, Complete by: Next sprint
